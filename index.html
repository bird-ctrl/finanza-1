<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanzas AI - Indian Finance Coach</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <meta name="description" content="AI-powered financial advisor for Indian market - Investment, Tax Planning, Banking, Insurance guidance">
    <meta name="keywords" content="Indian finance, SIP, mutual funds, tax planning, PPF, NPS, UPI, financial advisor">
</head>
<body data-color-scheme="light">
    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <div class="logo-container">
                <div class="logo-icon">‚Çπ</div>
                <h1 class="logo-text">Finanzas AI</h1>
            </div>
            <p class="splash-tagline">Your Indian Finance Coach</p>
            <div class="loading-spinner">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="main-app" class="main-app hidden">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <div class="logo-mini">‚Çπ</div>
                <h1 class="app-title">Finanzas AI</h1>
            </div>
            <div class="header-controls">
                <button id="theme-toggle" class="control-btn" title="Toggle Theme" aria-label="Toggle Theme">
                    <span class="theme-icon">üåô</span>
                </button>
                <button id="language-toggle" class="control-btn" title="Switch Language" aria-label="Switch Language">
                    <span class="lang-text">EN</span>
                </button>
                <button id="voice-toggle" class="control-btn" title="Toggle Voice" aria-label="Toggle Voice">
                    <span class="voice-icon">üîä</span>
                </button>
                <button id="settings-btn" class="control-btn" title="Settings" aria-label="Settings">
                    <span class="settings-icon">‚öôÔ∏è</span>
                </button>
            </div>
        </header>

        <!-- Usage Tracker -->
        <div class="usage-tracker">
            <div class="usage-bar">
                <div id="usage-fill" class="usage-fill"></div>
            </div>
            <span id="usage-text" class="usage-text">0/30 queries today</span>
        </div>

        <!-- Chat Container -->
        <main class="chat-container">
            <div id="chat-messages" class="chat-messages">
                <div class="welcome-message">
                    <div class="welcome-icon">üáÆüá≥</div>
                    <h2>Welcome to Finanzas AI!</h2>
                    <p>Your personal finance coach for Indian markets. Get expert advice on investments, tax planning, banking, insurance, and more.</p>
                </div>
            </div>

            <!-- Quick Response Buttons -->
            <div class="quick-responses">
                <button class="quick-btn" data-query="What is SIP and how to start?">SIP Basics</button>
                <button class="quick-btn" data-query="Best tax-saving options under 80C">80C Options</button>
                <button class="quick-btn" data-query="How to build emergency fund?">Emergency Fund</button>
                <button class="quick-btn" data-query="PPF vs NPS comparison">PPF vs NPS</button>
                <button class="quick-btn" data-query="Best mutual funds for beginners">Mutual Funds</button>
                <button class="quick-btn" data-query="UPI safety tips">UPI Safety</button>
            </div>
        </main>

        <!-- Input Area -->
        <div class="input-area">
            <div class="input-container">
                <button id="voice-input-btn" class="voice-btn" title="Voice Input" aria-label="Voice Input">
                    <span class="voice-pulse"></span>
                    üé§
                </button>
                <textarea 
                    id="message-input" 
                    class="message-input" 
                    placeholder="Ask about SIP, tax planning, mutual funds, insurance..."
                    rows="1"
                    maxlength="500"
                ></textarea>
                <button id="send-btn" class="send-btn" title="Send Message" aria-label="Send Message">
                    <span class="send-icon">‚Üí</span>
                </button>
            </div>
            <div class="input-footer">
                <span class="char-counter">0/500</span>
                <button id="export-btn" class="export-btn">Export Chat</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Settings</h3>
                <button id="close-settings" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="settings-group">
                    <h4>Voice Settings</h4>
                    <div class="setting-item">
                        <label for="voice-rate">Speech Rate</label>
                        <input type="range" id="voice-rate" min="0.5" max="2" step="0.1" value="1">
                        <span id="rate-value">1.0</span>
                    </div>
                    <div class="setting-item">
                        <label for="voice-pitch">Pitch</label>
                        <input type="range" id="voice-pitch" min="0" max="2" step="0.1" value="1">
                        <span id="pitch-value">1.0</span>
                    </div>
                    <div class="setting-item">
                        <label for="voice-volume">Volume</label>
                        <input type="range" id="voice-volume" min="0" max="1" step="0.1" value="0.8">
                        <span id="volume-value">0.8</span>
                    </div>
                </div>
                <div class="settings-group">
                    <h4>Chat Settings</h4>
                    <div class="setting-item">
                        <label for="auto-scroll">Auto-scroll to new messages</label>
                        <input type="checkbox" id="auto-scroll" checked>
                    </div>
                    <div class="setting-item">
                        <label for="typing-sound">Typing sounds</label>
                        <input type="checkbox" id="typing-sound" checked>
                    </div>
                </div>
                <div class="settings-group">
                    <h4>Data Management</h4>
                    <button id="clear-history" class="btn btn--outline">Clear Chat History</button>
                    <button id="reset-usage" class="btn btn--outline">Reset Daily Usage</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Voice Status Indicator -->
    <div id="voice-status" class="voice-status hidden">
        <div class="voice-animation">
            <div class="voice-bar"></div>
            <div class="voice-bar"></div>
            <div class="voice-bar"></div>
            <div class="voice-bar"></div>
        </div>
        <span id="voice-status-text">Listening...</span>
    </div>

    <!-- Offline Indicator -->
    <div id="offline-indicator" class="offline-indicator hidden">
        <span>üìµ Offline Mode - Limited functionality</span>
    </div>

    <!-- Backend Proxy Server Code (for deployment) -->
    <script type="application/json" id="backend-config">
    {
      "server_code": "// server.js - Deploy this as your backend proxy\nconst express = require('express');\nconst cors = require('cors');\nconst rateLimit = require('express-rate-limit');\nconst { GoogleGenerativeAI } = require('@google/generative-ai');\nrequire('dotenv').config();\n\nconst app = express();\nconst PORT = process.env.PORT || 3001;\n\n// Initialize Gemini AI\nconst genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);\nconst model = genAI.getGenerativeModel({ model: 'gemini-pro' });\n\n// Middleware\napp.use(cors({\n  origin: process.env.FRONTEND_URL || '*',\n  credentials: true\n}));\napp.use(express.json({ limit: '10mb' }));\n\n// Rate limiting - 30 requests per IP per day\nconst limiter = rateLimit({\n  windowMs: 24 * 60 * 60 * 1000, // 24 hours\n  max: 30, // limit each IP to 30 requests per windowMs\n  message: { error: 'Daily limit exceeded. Try again tomorrow.' },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\napp.use('/api/', limiter);\n\n// Indian Finance Context Prompt\nconst INDIAN_FINANCE_CONTEXT = `You are Finanzas AI, an expert Indian finance advisor. Provide practical, accurate advice on:\n- Indian investments: SIP, mutual funds, stocks, bonds, ELSS\n- Tax planning: 80C deductions, new vs old tax regime, LTCG/STCG\n- Banking: savings accounts, FDs, RDs, interest rates\n- Insurance: health, life, term insurance, ULIP\n- Digital payments: UPI, wallets, safety tips\n- Retirement: PPF, NPS, EPF, pension schemes\n- Goal planning: emergency funds, budgeting, loans\n\nAlways:\n- Use Indian rupees (‚Çπ) for amounts\n- Reference current Indian financial regulations\n- Provide actionable, beginner-friendly advice\n- Include specific examples and calculations when helpful\n- Keep responses concise but comprehensive`;\n\n// Health check endpoint\napp.get('/health', (req, res) => {\n  res.json({ status: 'healthy', timestamp: new Date().toISOString() });\n});\n\n// Chat endpoint\napp.post('/api/chat', async (req, res) => {\n  try {\n    const { message, language = 'English' } = req.body;\n    \n    if (!message || message.trim().length === 0) {\n      return res.status(400).json({ error: 'Message is required' });\n    }\n    \n    if (message.length > 500) {\n      return res.status(400).json({ error: 'Message too long. Limit: 500 characters' });\n    }\n    \n    const languageInstruction = language === 'Hindi' ? \n      ' Please respond in Hindi (Devanagari script) when possible, but use English for technical terms.' : \n      ' Please respond in English.';\n    \n    const prompt = `${INDIAN_FINANCE_CONTEXT}${languageInstruction}\n\nUser question: ${message}`;\n    \n    const result = await model.generateContent(prompt);\n    const response = await result.response;\n    const text = response.text();\n    \n    res.json({ \n      response: text,\n      timestamp: new Date().toISOString(),\n      language: language\n    });\n    \n  } catch (error) {\n    console.error('Gemini API Error:', error);\n    \n    if (error.message.includes('API key')) {\n      return res.status(401).json({ error: 'Invalid API key configuration' });\n    }\n    \n    if (error.message.includes('quota')) {\n      return res.status(429).json({ error: 'API quota exceeded. Please try again later.' });\n    }\n    \n    res.status(500).json({ \n      error: 'Unable to process your request. Please try again.',\n      details: process.env.NODE_ENV === 'development' ? error.message : undefined\n    });\n  }\n});\n\n// Error handling middleware\napp.use((error, req, res, next) => {\n  console.error('Server Error:', error);\n  res.status(500).json({ error: 'Internal server error' });\n});\n\n// 404 handler\napp.use('*', (req, res) => {\n  res.status(404).json({ error: 'Endpoint not found' });\n});\n\napp.listen(PORT, () => {\n  console.log(`üöÄ Finanzas AI Backend running on port ${PORT}`);\n  console.log(`üìä Rate limit: 30 requests per IP per day`);\n  console.log(`üîë Gemini API: ${process.env.GEMINI_API_KEY ? 'Configured' : 'Missing'}`);\n});\n\nmodule.exports = app;",
      "package_json": "{\n  \"name\": \"finanzas-ai-backend\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Backend proxy for Finanzas AI - Indian Finance Coach\",\n  \"main\": \"server.js\",\n  \"scripts\": {\n    \"start\": \"node server.js\",\n    \"dev\": \"nodemon server.js\"\n  },\n  \"dependencies\": {\n    \"express\": \"^4.18.2\",\n    \"cors\": \"^2.8.5\",\n    \"express-rate-limit\": \"^7.1.5\",\n    \"@google/generative-ai\": \"^0.2.1\",\n    \"dotenv\": \"^16.3.1\"\n  },\n  \"devDependencies\": {\n    \"nodemon\": \"^3.0.2\"\n  },\n  \"engines\": {\n    \"node\": \">=16.0.0\"\n  }\n}"
    }
    </script>

    <script src="app.js"></script>
</body>
</html>